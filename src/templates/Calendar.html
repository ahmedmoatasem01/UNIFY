<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar with Tasks</title>
    <script src="https://apis.google.com/js/client.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #764ba2;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .calendar-wrapper {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
        }

        .day-cell {
            min-height: 120px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 8px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s;
            overflow-y: auto;
        }

        .day-cell:hover {
            border-color: #667eea;
            background: #f0f0ff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .day-cell.other-month {
            background: #f5f5f5;
            color: #999;
        }

        .day-cell.today {
            background: #fff3cd;
            border-color: #667eea;
            font-weight: bold;
        }

        .day-number {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .day-events {
            font-size: 11px;
            line-height: 1.4;
        }

        .event {
            background: #667eea;
            color: white;
            padding: 3px 5px;
            margin: 2px 0;
            border-radius: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .event.task {
            background: #28a745;
        }

        .event.calendar {
            background: #007bff;
        }

        .sidebar {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .upcoming-list {
            list-style: none;
        }

        .upcoming-item {
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            font-size: 12px;
        }

        .upcoming-item.task {
            border-left-color: #28a745;
        }

        .upcoming-item.calendar {
            border-left-color: #007bff;
        }

        .upcoming-time {
            color: #666;
            font-size: 11px;
        }

        .status {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 6px;
            color: #333;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="monthYear">December 2025</h1>
            <div class="controls">
                <button onclick="previousMonth()">‚Üê Previous</button>
                <button onclick="todayMonth()">Today</button>
                <button onclick="nextMonth()">Next ‚Üí</button>
                <button id="authBtn" onclick="handleAuthClick()">Sign in with Google</button>
            </div>
        </div>

        <div id="status" class="status"></div>

        <div class="calendar-wrapper">
            <div>
                <div class="calendar" id="calendarGrid"></div>
            </div>

            <div class="sidebar">
                <h3>Upcoming Events & Tasks</h3>
                <ul class="upcoming-list" id="upcomingList">
                    <li class="upcoming-item">Loading...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';
        const Student_ID = '201234567'; // Replace with actual student ID
        const API_KEY = 'bdd46e3d8127abc7d1746d89da3122ee5743396f5ebd15e389791c2234f28964';

        let currentDate = new Date();
        let calendarEvents = {};
        let tasksData = {};

        // Initialize
        window.addEventListener('load', () => {
            gapi.load('client:auth2', initClient);
            loadTasksFromReminder();
            renderCalendar();
        });

        // Initialize Google API Client
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                studentId: Student_ID,
                scope: SCOPES,
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
            }).then(() => {
                const authBtn = document.getElementById('authBtn');
                const isSignedIn = gapi.auth2.getAuthInstance().isSignedIn.get();
                authBtn.textContent = isSignedIn ? 'Sign out' : 'Sign in with Google';
                if (isSignedIn) loadCalendarEvents();
            });
        }

        // Handle Authentication
        function handleAuthClick() {
            const authInstance = gapi.auth2.getAuthInstance();
            const isSignedIn = authInstance.isSignedIn.get();
            if (isSignedIn) {
                authInstance.signOut().then(() => {
                    document.getElementById('authBtn').textContent = 'Sign in with Google';
                    calendarEvents = {};
                    renderCalendar();
                    showStatus('Signed out successfully', 'success');
                });
            } else {
                authInstance.signIn().then(() => {
                    document.getElementById('authBtn').textContent = 'Sign out';
                    loadCalendarEvents();
                    showStatus('Signed in successfully', 'success');
                });
            }
        }

        // Load Google Calendar Events
        function loadCalendarEvents() {
            const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

            gapi.client.calendar.events.list({
                calendarId: 'primary',
                timeMin: startOfMonth.toISOString(),
                timeMax: endOfMonth.toISOString(),
                showDeleted: false,
                singleEvents: true,
                orderBy: 'startTime',
            }).then(response => {
                calendarEvents = {};
                const events = response.result.items || [];
                
                events.forEach(event => {
                    const eventDate = new Date(event.start.dateTime || event.start.date);
                    const dateKey = formatDateKey(eventDate);
                    
                    if (!calendarEvents[dateKey]) {
                        calendarEvents[dateKey] = [];
                    }
                    
                    calendarEvents[dateKey].push({
                        title: event.summary,
                        time: event.start.dateTime ? eventDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'All Day',
                        type: 'calendar'
                    });
                });
                
                renderCalendar();
                updateUpcomingList();
                showStatus(`Loaded ${events.length} calendar events`, 'success');
            }).catch(error => {
                showStatus('Error loading calendar: ' + error.message, 'error');
            });
        }

        // Load Tasks from Reminder (Mock - Replace with your API)
        function loadTasksFromReminder() {
            // This is a mock implementation
            // Replace with your actual reminder API endpoint
            fetch('/api/reminders') // Adjust endpoint to your API
                .then(response => response.json())
                .then(tasks => {
                    tasksData = {};
                    tasks.forEach(task => {
                        const taskDate = new Date(task.dueDate);
                        const dateKey = formatDateKey(taskDate);
                        
                        if (!tasksData[dateKey]) {
                            tasksData[dateKey] = [];
                        }
                        
                        tasksData[dateKey].push({
                            title: task.title,
                            time: new Date(task.dueDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                            type: 'task',
                            priority: task.priority
                        });
                    });
                    
                    renderCalendar();
                    updateUpcomingList();
                })
                .catch(() => {
                    // If API not available, use mock data
                    console.log('Using mock tasks data');
                    loadMockTasks();
                });
        }

        // Mock Tasks for Demo
        function loadMockTasks() {
            const today = new Date();
            tasksData = {};
            
            for (let i = 0; i < 5; i++) {
                const taskDate = new Date(today.getTime() + i * 24 * 60 * 60 * 1000);
                const dateKey = formatDateKey(taskDate);
                
                if (!tasksData[dateKey]) {
                    tasksData[dateKey] = [];
                }
                
                tasksData[dateKey].push({
                    title: `Task ${i + 1}`,
                    time: `${10 + i}:00 AM`,
                    type: 'task'
                });
            }
            
            renderCalendar();
            updateUpcomingList();
        }

        // Format date key (YYYY-MM-DD)
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // Render Calendar
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            // Update header
            document.getElementById('monthYear').textContent = 
                currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            // Create calendar grid
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // Day headers
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const cell = createDayCell(daysInPrevMonth - i, true, new Date(year, month - 1, daysInPrevMonth - i));
                grid.appendChild(cell);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = createDayCell(day, false, new Date(year, month, day));
                grid.appendChild(cell);
            }

            // Next month days
            const totalCells = grid.children.length - 7; // Subtract day headers
            const remainingCells = 42 - totalCells; // 6 rows √ó 7 days
            for (let day = 1; day <= remainingCells; day++) {
                const cell = createDayCell(day, true, new Date(year, month + 1, day));
                grid.appendChild(cell);
            }
        }

        // Create Day Cell
        function createDayCell(day, isOtherMonth, date) {
            const cell = document.createElement('div');
            const dateKey = formatDateKey(date);
            const today = formatDateKey(new Date());

            cell.className = 'day-cell';
            if (isOtherMonth) cell.classList.add('other-month');
            if (dateKey === today) cell.classList.add('today');

            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            cell.appendChild(dayNumber);

            const eventsDiv = document.createElement('div');
            eventsDiv.className = 'day-events';

            // Add calendar events
            if (calendarEvents[dateKey]) {
                calendarEvents[dateKey].forEach(event => {
                    const eventEl = document.createElement('div');
                    eventEl.className = 'event calendar';
                    eventEl.textContent = `üìÖ ${event.title}`;
                    eventEl.title = `${event.time}`;
                    eventsDiv.appendChild(eventEl);
                });
            }

            // Add tasks
            if (tasksData[dateKey]) {
                tasksData[dateKey].forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'event task';
                    taskEl.textContent = `‚úì ${task.title}`;
                    taskEl.title = `${task.time}`;
                    eventsDiv.appendChild(taskEl);
                });
            }

            cell.appendChild(eventsDiv);
            return cell;
        }

        // Update Upcoming List
        function updateUpcomingList() {
            const upcomingList = document.getElementById('upcomingList');
            const upcoming = [];

            // Collect all events and tasks for next 14 days
            for (let i = 0; i < 14; i++) {
                const date = new Date();
                date.setDate(date.getDate() + i);
                const dateKey = formatDateKey(date);

                if (calendarEvents[dateKey]) {
                    calendarEvents[dateKey].forEach(event => {
                        upcoming.push({
                            title: event.title,
                            date: dateKey,
                            time: event.time,
                            type: 'calendar'
                        });
                    });
                }

                if (tasksData[dateKey]) {
                    tasksData[dateKey].forEach(task => {
                        upcoming.push({
                            title: task.title,
                            date: dateKey,
                            time: task.time,
                            type: 'task'
                        });
                    });
                }
            }

            // Sort by date and time
            upcoming.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Display
            if (upcoming.length === 0) {
                upcomingList.innerHTML = '<li class="upcoming-item">No upcoming events</li>';
            } else {
                upcomingList.innerHTML = upcoming.map(item => `
                    <li class="upcoming-item ${item.type}">
                        <strong>${item.type === 'task' ? '‚úì' : 'üìÖ'} ${item.title}</strong>
                        <div class="upcoming-time">${item.date} at ${item.time}</div>
                    </li>
                `).join('');
            }
        }

        // Navigation
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function todayMonth() {
            currentDate = new Date();
            renderCalendar();
        }

        // Show Status Message
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            setTimeout(() => {
                status.textContent = '';
                status.className = 'status';
            }, 3000);
        }
    </script>
</body>
</html>