<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Plan Details - UNIFY</title>
    <meta name="description" content="View and manage your study plan details">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/study_plans.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/main.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="detail-header">
            <div class="breadcrumb">
                <a href="/study-plans">‚Üê Back to Study Plans</a>
            </div>
            <div class="header-content">
                <h1 id="planTitle">Loading...</h1>
                <div class="plan-meta">
                    <span class="status-badge" id="planStatus">Active</span>
                    <span class="date-range" id="planDates"></span>
                </div>
            </div>
            <div class="header-actions">
                <button id="adjustPlanBtn" class="btn btn-secondary">
                    <span class="icon">üîÑ</span>
                    Adjust Plan
                </button>
                <button id="editPlanBtn" class="btn btn-secondary">
                    <span class="icon">‚úèÔ∏è</span>
                    Edit
                </button>
            </div>
        </header>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-card">
                <h3>Overall Progress</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="progressText" class="progress-text">0%</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedTasks">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingTasks">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="estimatedHours">0h</div>
                    <div class="stat-label">Est. Hours</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-grid">
            <!-- Tasks Section -->
            <div class="tasks-section">
                <div class="section-header">
                    <h2>üìã Study Tasks</h2>
                    <button id="addTaskBtn" class="btn btn-primary btn-sm">
                        <span class="icon">‚ûï</span>
                        Add Task
                    </button>
                </div>

                <!-- Task Filters -->
                <div class="task-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="in_progress">In Progress</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                </div>

                <div id="tasksContainer" class="tasks-list">
                    <div class="loading">Loading tasks...</div>
                </div>
            </div>

            <!-- Recommendations Section -->
            <div class="recommendations-section">
                <div class="section-header">
                    <h2>üí° AI Recommendations</h2>
                    <button id="refreshRecommendations" class="btn btn-secondary btn-sm">
                        <span class="icon">üîÑ</span>
                        Refresh
                    </button>
                </div>

                <div id="recommendationsContainer" class="recommendations-list">
                    <div class="loading">Loading recommendations...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Study Task</h2>
                <button class="close-btn" onclick="closeAddTaskModal()">&times;</button>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="taskTitle">Task Title *</label>
                    <input type="text" id="taskTitle" name="taskTitle" required
                        placeholder="e.g., Review Chapter 5 - Binary Trees">
                </div>

                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription" name="taskDescription" rows="3"
                        placeholder="Additional details about this task..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="estimatedHours">Estimated Hours</label>
                        <input type="number" id="estimatedHours" name="estimatedHours" min="0.5" step="0.5"
                            placeholder="2.5">
                    </div>
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="datetime-local" id="taskDueDate" name="taskDueDate">
                    </div>
                </div>

                <div class="form-group">
                    <label for="taskPriority">Priority</label>
                    <select id="taskPriority" name="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoDecompose" name="autoDecompose">
                        <span>ü§ñ Auto-decompose into subtasks (for tasks > 4 hours)</span>
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddTaskModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Add Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Task</h2>
                <button class="close-btn" onclick="closeEditTaskModal()">&times;</button>
            </div>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId">

                <div class="form-group">
                    <label for="editTaskTitle">Task Title *</label>
                    <input type="text" id="editTaskTitle" name="taskTitle" required>
                </div>

                <div class="form-group">
                    <label for="editTaskDescription">Description</label>
                    <textarea id="editTaskDescription" name="taskDescription" rows="3"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editEstimatedHours">Estimated Hours</label>
                        <input type="number" id="editEstimatedHours" name="estimatedHours" min="0.5" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="editActualHours">Actual Hours</label>
                        <input type="number" id="editActualHours" name="actualHours" min="0" step="0.5">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editTaskDueDate">Due Date</label>
                        <input type="datetime-local" id="editTaskDueDate" name="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label for="editTaskPriority">Priority</label>
                        <select id="editTaskPriority" name="taskPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editTaskStatus">Status</label>
                    <select id="editTaskStatus" name="taskStatus">
                        <option value="pending">Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="skipped">Skipped</option>
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteTask()">
                        Delete
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditTaskModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const PLAN_ID = {{ plan_id }};
    </script>
    <script src="{{ url_for('static', filename='scripts/study_plans.js') }}"></script>
</body>

</html>