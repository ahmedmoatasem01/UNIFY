<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Material - {{ course.Course_Name }} - Unify</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/course_registration.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/course_materials.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="cr-body">
<div class="cr-app-layout">
    <aside class="cr-sidebar">
        <div class="cr-sidebar-header">
            <div class="cr-brand-logo">U</div>
            <div>
                <h2 class="cr-brand-title">Unify</h2>
                <p class="cr-brand-subtitle">Student Assistant</p>
            </div>
        </div>
        <nav class="cr-sidebar-nav">
            <a class="cr-nav-item" href="/overview"><i class="fa-solid fa-chart-column"></i><span>Overview</span></a>
            <a class="cr-nav-item" href="/schedule"><i class="fa-solid fa-calendar-day"></i><span>Schedule</span></a>
            <a class="cr-nav-item" href="/tasks"><i class="fa-solid fa-list-check"></i><span>Tasks</span></a>
            <a class="cr-nav-item" href="/notes"><i class="fa-solid fa-note-sticky"></i><span>Notes &amp; Summaries</span></a>
            <a class="cr-nav-item" href="/reminders"><i class="fa-solid fa-bell"></i><span>Smart Reminders</span></a>
            <a class="cr-nav-item" href="/messages"><i class="fa-solid fa-message"></i><span>Messages</span></a>
            <a class="cr-nav-item" href="/transcript"><i class="fa-solid fa-file-lines"></i><span>Transcript</span></a>
            <a class="cr-nav-item" href="/course-registration"><i class="fa-solid fa-book-open"></i><span>Course Registration</span></a>
            <a class="cr-nav-item active" href="/course-materials"><i class="fa-solid fa-folder-open"></i><span>Course Materials</span></a>
            <a class="cr-nav-item" href="/settings"><i class="fa-solid fa-gear"></i><span>Settings</span></a>
        </nav>
        <div class="cr-sidebar-footer">
            <button class="cr-btn-ghost cr-logout-btn" onclick="handleLogout()">
                <i class="fa-solid fa-arrow-right-from-bracket"></i><span>Log out</span>
            </button>
            <p class="cr-small-text">CSAI 203 Â· Team 27</p>
        </div>
    </aside>

    <div class="cr-main-panel">
        <header class="cr-topbar">
            <div class="cr-topbar-left">
                <h1><i class="fas fa-upload"></i> Upload Course Material</h1>
                <p>Upload materials for {{ course.Course_Name }}</p>
            </div>
            {% include 'components/topbar_right.html' %}
        </header>

        <main class="cr-main">
            <div class="upload-material-container">
                <div class="upload-header">
                    <div class="header-left">
                        <a href="{{ url_for('course_material.course_materials_page', course_id=course.Course_ID) }}" class="btn btn-secondary" style="margin-bottom: 1rem; display: inline-flex;">
                            <i class="fas fa-arrow-left"></i> Back to Materials
                        </a>
                    </div>
                </div>

    <div class="upload-form-container">
        <form id="uploadMaterialForm" enctype="multipart/form-data">
            <input type="hidden" name="course_id" value="{{ course.Course_ID }}">

            <div class="form-group">
                <label for="material_title">Material Title *</label>
                <input type="text" id="material_title" name="material_title" required
                       placeholder="e.g., Lecture 1 Slides, Assignment 2, Video Tutorial">
            </div>

            <div class="upload-type-selector">
                <label>Upload Type:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="upload_type" value="file" checked>
                        <span>Upload File</span>
                    </label>
                    <label>
                        <input type="radio" name="upload_type" value="link">
                        <span>Add Link</span>
                    </label>
                </div>
            </div>

            <div id="fileUploadSection" class="upload-section">
                <div class="form-group">
                    <label for="file">Select File *</label>
                    <input type="file" id="file" name="file" accept=".pdf,.pptx,.ppt,.doc,.docx,.xls,.xlsx,.txt,.jpg,.jpeg,.png,.gif,.mp4,.avi,.mov,.zip,.rar">
                    <small>Allowed: PDF, PowerPoint, Word, Excel, Images, Videos, ZIP (Max 100MB)</small>
                </div>
            </div>

            <div id="linkUploadSection" class="upload-section" style="display: none;">
                <div class="form-group">
                    <label for="link_url">Link URL *</label>
                    <input type="url" id="link_url" name="link_url" placeholder="https://example.com/resource">
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3" 
                          placeholder="Brief description of the material (optional)"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="week_number">Week Number</label>
                    <input type="number" id="week_number" name="week_number" min="0" 
                           placeholder="0 for general materials">
                </div>

                <div class="form-group">
                    <label for="topic">Topic</label>
                    <input type="text" id="topic" name="topic" 
                           placeholder="e.g., Introduction, Variables, Loops">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Upload Material
                </button>
                <button type="reset" class="btn btn-secondary">Clear</button>
            </div>
        </form>

        <div id="uploadStatus" class="upload-status" style="display: none;"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('uploadMaterialForm');
    const uploadTypeRadios = document.querySelectorAll('input[name="upload_type"]');
    const fileSection = document.getElementById('fileUploadSection');
    const linkSection = document.getElementById('linkUploadSection');
    const statusDiv = document.getElementById('uploadStatus');

    // Toggle between file and link upload
    uploadTypeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'file') {
                fileSection.style.display = 'block';
                linkSection.style.display = 'none';
                document.getElementById('file').required = true;
                document.getElementById('link_url').required = false;
            } else {
                fileSection.style.display = 'none';
                linkSection.style.display = 'block';
                document.getElementById('file').required = false;
                document.getElementById('link_url').required = true;
            }
        });
    });

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        statusDiv.style.display = 'block';
        statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        statusDiv.className = 'upload-status loading';

        const formData = new FormData(form);
        const uploadType = document.querySelector('input[name="upload_type"]:checked').value;

        if (uploadType === 'link') {
            formData.delete('file');
        } else {
            formData.delete('link_url');
        }

        try {
            const response = await fetch('/course-materials/api', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (response.ok) {
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Material uploaded successfully!';
                statusDiv.className = 'upload-status success';
                form.reset();
                setTimeout(() => {
                    window.location.href = `/course-materials/course/{{ course.Course_ID }}`;
                }, 1500);
            } else {
                statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${data.error || 'Upload failed'}`;
                statusDiv.className = 'upload-status error';
            }
        } catch (error) {
            statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${error.message}`;
            statusDiv.className = 'upload-status error';
        }
    });
});
</script>
        </main>
    </div>
</div>

<script>
async function handleLogout() {
    try {
        const response = await fetch('/auth/logout', { method: 'POST' });
        if (response.ok) {
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Logout error:', error);
        window.location.href = '/login';
    }
}
</script>
</body>
</html>

